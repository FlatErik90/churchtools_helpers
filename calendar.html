<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalendereinträge</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Kalendereinträge</h1>
        <ul id="kalender-liste" class="list-group mt-3"></ul>
    </div>

    <script>
        $(document).ready(function() {
            // Direkte Anfrage an die externe API (ohne Proxy)
            $.ajax({
                url: 'https://nak.churchtools.de/?q=churchcal/ajax&func=getCalPerCategory&calendar_ids[0]=1&category_ids[0]=1&category_ids[1]=3&category_ids[3]=5',
                type: 'POST',
                success: function(response) {
                    // Überprüfe, ob die Antwort ein Objekt mit "data" ist
                    if (response && response.status === "success" && response.data) {
                        // Hole das "data" Objekt
                        var dataObject = response.data;

                        // Hier verarbeitest du die Antwort und fügst die Einträge in deine Liste ein
                        var kalenderListe = $('#kalender-liste');

                        // Iteriere durch die Eigenschaften des "data" Objekts
                        Object.keys(dataObject).forEach(function(key) {
                            // Hole das "bezeichnung" und "startdate" von jedem Eintrag
                            var calEntry = dataObject[key];
                            Object.keys(calEntry).forEach(function(dateKey) {
                            
                                var dateEntry = calEntry[dateKey];
                                var bezeichnung = dateEntry.bezeichnung;
                                var startdate = dateEntry.startdate;

                                // Formatiere das Datum
                                var formattedDate = new Date(startdate);
                                var formattedDateString = formattedDate.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });

                                // Füge die Einträge in die Liste ein
                                kalenderListe.append('<li class="list-group-item">' + bezeichnung + ' - ' + formattedDateString + ' Uhr</li>');
                            });
                        });
                    } else {
                        console.error('Die Antwort entspricht nicht dem erwarteten Format:', response);
                    }
                },
                error: function(error) {
                    console.error('Fehler bei der Anfrage:', error);
                }
            });
        });
    </script>
</body>
</html>
